<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>出站管理</title>
    <style>
        /* 全局样式 */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f6f9;
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        h1 {
            font-size: 32px;
            color: #444;
            text-align: center;
            margin-top: 30px;
        }

        /* 主容器样式 */
        .container {
            max-width: 600px;
            width: 100%;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .status-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .status {
            font-size: 18px;
            color: #333;
        }

        .status span {
            color: green; /* 当前出站状态的模式内容用绿色字体 */
            font-weight: bold;
        }

        /* 模式选择部分 */
        .mode-select {
            margin-bottom: 20px;
        }

        .mode-select label {
            font-size: 18px;
            font-weight: bold;
            margin-right: 10px;
        }

        .mode-select select {
            padding: 8px;
            font-size: 16px;
            width: 100%;
            border-radius: 4px;
            border: 1px solid #ddd;
        }

        /* 配置按钮 */
        .button-container {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
        }

        button {
            padding: 10px 20px;
            margin: 5px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 4px;
            background-color: #4CAF50;
            color: white;
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: #45a049;
        }

        /* 设置区域样式 */
        .socks-settings,
        .disable-settings,
        .wireguard-settings {
            display: none;
            margin-top: 20px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            margin-bottom: 15px;
        }

        .input-group input {
            padding: 8px;
            font-size: 14px;
            width: 80%; /* 设置为80%宽度 */
            margin: 5px auto;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .confirm-btn {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }

        .confirm-btn button {
            background-color: #FF5722;
        }

        .mode-select select option {
            font-size: 16px;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>出站管理</h1>

        <div class="status-container">
            <div class="status">当前出站状态: <span id="status">加载中...</span></div>
        </div>

        <!-- 模式选择 -->
        <div class="mode-select">
            <label for="mode">选择模式:</label>
            <select id="mode" onchange="changeMode()">
                <option value="wireguard">WireGuard</option>
                <option value="socks">Socks</option>
                <option value="disable">关闭出站</option>
            </select>
        </div>

        <!-- WireGuard 配置 -->
        <div class="wireguard-settings" id="wireguard-settings">
            <h3>WireGuard 配置</h3>
            <button onclick="setWireGuard()">确认设置 WireGuard</button>
        </div>

        <!-- Socks 配置 -->
        <div class="socks-settings" id="socks-settings">
            <h3>Socks 配置</h3>
            <div class="input-group">
                <input type="text" id="server" placeholder="服务器地址" />
                <input type="number" id="server_port" placeholder="端口 (1000-65535)" />
                <input type="text" id="username" placeholder="用户名" />
                <input type="password" id="password" placeholder="密码" />
            </div>
            <button onclick="setSocks()">确认设置 Socks</button>
        </div>

        <!-- 关闭模式 -->
        <div class="disable-settings" id="disable-settings">
            <div class="confirm-btn">
                <button onclick="disableOutbound()">确认关闭出站</button>
            </div>
        </div>
    </div>

    <script>
        // 获取当前出站状态
        async function getOutboundStatus() {
            try {
                let res = await fetch("/getOutboundStatus");
                let data = await res.json();
                document.getElementById("status").textContent = data.status;

                // 设置模式选择框的默认值
                if (data.mode === "wireguard") {
                    document.getElementById('mode').value = 'wireguard';
                    changeMode();
                } else if (data.mode === "socks") {
                    document.getElementById('mode').value = 'socks';
                    changeMode();
                } else if (data.mode === "disable") {
                    document.getElementById('mode').value = 'disable';
                    changeMode();
                }
            } catch (err) {
                document.getElementById("status").textContent = "无法获取状态";
            }
        }

        // 切换到 WireGuard
        async function setWireGuard() {
            await fetch("/setWireGuard", { method: "POST" });
            alert("WireGuard 出站已设置");
            getOutboundStatus();
        }

        // 显示 WireGuard 配置
        function showWireGuardSettings() {
            document.getElementById("wireguard-settings").style.display = "block";
            document.getElementById("socks-settings").style.display = "none";
            document.getElementById("disable-settings").style.display = "none";
        }

        // 显示 Socks 配置
        function showSocksSettings() {
            document.getElementById("socks-settings").style.display = "block";
            document.getElementById("wireguard-settings").style.display = "none";
            document.getElementById("disable-settings").style.display = "none";
        }

        // 设置 Socks 出站
        async function setSocks() {
            let server = document.getElementById("server").value;
            let server_port = document.getElementById("server_port").value;
            let username = document.getElementById("username").value;
            let password = document.getElementById("password").value;

            if (!server || !server_port || !username || !password) {
                alert("请填写完整的 Socks 配置");
                return;
            }

            await fetch("/setSocks", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ server, server_port, username, password })
            });

            alert("Socks 出站已设置");
            getOutboundStatus();
        }

        // 显示关闭模式设置
        function showDisableSettings() {
            document.getElementById("disable-settings").style.display = "block";
            document.getElementById("wireguard-settings").style.display = "none";
            document.getElementById("socks-settings").style.display = "none";
        }

        // 关闭所有出站
        async function disableOutbound() {
            await fetch("/disableOutbound", { method: "POST" });
            alert("出站已关闭");
            getOutboundStatus();
        }

        // 切换模式
        function changeMode() {
            const mode = document.getElementById('mode').value;
            if (mode === 'socks') {
                showSocksSettings();
            } else if (mode === 'disable') {
                showDisableSettings();
            } else if (mode === 'wireguard') {
                showWireGuardSettings();
            }
        }

        // 页面加载时获取出站状态并动态设置默认值
        window.onload = function() {
            getOutboundStatus();
        };
    </script>

</body>
</html>